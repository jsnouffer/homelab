---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: democratic-csi-driver-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: doppler-secret-store
  target:
    name: democratic-csi-driver-config
    deletionPolicy: Delete
    template:
      data:
        driver-config-file.yaml: |
          driver: freenas-nfs
          httpConnection:
            allowInsecure: true
            apiKey: {{ `{{ .api_key }}` }}
            apiVersion: 2
            host: nas.jsnouff.net
            port: 443
            protocol: https
            username: root
          nfs:
            shareAlldirs: false
            shareAllowedHosts: []
            shareAllowedNetworks: []
            shareHost: nas.jsnouff.net
            shareMapallGroup: ""
            shareMapallUser: ""
            shareMaprootGroup: wheel
            shareMaprootUser: root
          sshConnection:
            host: nas.jsnouff.net
            password: {{ `{{ .ssh_password }}` }}
            port: 22
            username: root
          zfs:
            datasetEnableQuotas: true
            datasetEnableReservation: false
            datasetParentName: pool/k8s/cobra-nfs/vols
            datasetPermissionsGroup: 0
            datasetPermissionsMode: "0777"
            datasetPermissionsUser: 0
            detachedSnapshotsDatasetParentName: pool/k8s/cobra-nfs/snaps
  data:
    - secretKey: api_key
      remoteRef:
        key: DEMOCRATIC_CSI_TRUENAS_API_KEY
    - secretKey: ssh_password
      remoteRef:
        key: DEMOCRATIC_CSI_TRUENAS_SSH_PASSWORD